<include file="Public/header"/>
<script>
    $(function() {
        $('select').chosen();
    });
</script>
<div id="content-container">
    <div id="page-content">
        <div class="panel">
            <div class="panel-heading">
                <h3 class="panel-title">交易列表</h3>
            </div>
            <!--筛选功能开始-->
            <div class="row">
                <div class="col-sm-12">
                    <form method="post" action="{:U('index')}">
                        <div class="panel-body">
                            <div class="row">

                                <div class="col-sm-3">
                                    <div class="form-group">
                                        <label class="control-label">所属品牌</label>
                                        <select class="form-control" name="domain_auth" id="domain_auths" style="width: 300px;">
                                            <option value="">--请选择--</option>
                                            <volist name=":DomainAuthList()" id="v">
                                                <option value="{$v.web_authcode}">{$v.web_name}</option>
                                            </volist>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-sm-2">
                                    <div class="form-group">
                                        <label class="control-label">交易单号</label>
                                        <input class="form-control" type="text" placeholder="支持订单号泛查询" name="trade_no" value="{$data.trade_no}">
                                    </div>
                                </div>
                                <div class="col-sm-2">
                                    <div class="form-group">
                                        <label class="control-label">所属代理</label>
                                        <input id="dialog_name" class="form-control dialog" type="text"  readonly>
                                        <input id="dialog_aid" class="form-control" type="hidden" name="aid" value="">
                                    </div>
                                </div>
                                <div class="col-sm-2">
                                    <div class="form-group">
                                        <label class="control-label">所属商户</label>
                                        <input id="dialog_mch_name" class="form-control mid_dialog" type="text" readonly>
                                        <input id="dialog_mid" class="form-control" type="hidden" name="mid" value="">
                                    </div>
                                </div>
                                <div class="col-sm-3">
                                    <div class="form-group">
                                        <label class="control-label">门店名称</label>
                                        <input id="dialog_store_name" class="form-control store_dialog" type="text"  value="" readonly>
                                        <input id="dialog_store_id" class="form-control" type="hidden" name="store_id" value="">
                                    </div>
                                </div>
                                <!--<div class="col-sm-3">
                                    <div class="form-group">
                                        <label class="control-label">支付类型</label>
                                        <select data-placeholder="请选择..." id="paytype" tabindex="2" class="form-control" name="paytype">
                                            <option value="" >--请选择--</option>
                                            <option value="pay.weixin.jspay" <eq name="data.paytype" value="pay.weixin.jspay">selected="selected"</eq>>微信JS支付</option>
                                            <option value="pay.weixin.native" <eq name="data.paytype" value="pay.weixin.native">selected="selected"</eq>>微信扫码支付</option>
                                            <option value="pay.alipay.jspay" <eq name="data.paytype" value="pay.alipay.jspay">selected="selected"</eq>>支付宝JS支付</option>
                                            <option value="pay.alipay.native" <eq name="data.paytype" value="pay.alipay.native">selected="selected"</eq>>支付宝扫码支付</option>
                                            <option value="unified.trade.micropay" <eq name="data.paytype" value="unified.trade.micropay">selected="selected"</eq>>微信/支付宝条码支付</option>
                                        </select>
                                    </div>
                                </div>-->


                            </div>
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label class="control-label">时间范围</label>
                                        <div class="input-daterange input-group" >
                                            <input type="text" class="form-control" id="STime" name="s_time" value="{$data.s_time}"/>
                                            <span class="input-group-addon">To</span>
                                            <input type="text" class="form-control" id="ETime" name="e_time" value="{$data.e_time}"/>
                                            <span class="input-group-addon btn"  style="border-width:1px;" onclick="SetTime(1)">昨天</span>
                                            <span class="input-group-addon btn"  style="border-width:1px;" onclick="SetTime(2)">今天</span>
                                            <span class="input-group-addon btn"  style="border-width:1px;" onclick="SetTime(3)">近七天</span>
                                            <span class="input-group-addon btn"  style="border-width:1px;" onclick="SetTime(4)">近一月</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-sm-2">
                                    <div class="form-group">
                                        <label class="control-label">通道类型</label>
                                        <select data-placeholder="请选择..." id="type" tabindex="2" class="form-control" name="type">
                                            <option value="" >--请选择--</option>
                                            <option value="T1" <eq name="data.type" value="T1">selected="selected"</eq> >T1</option>
                                            <option value="T0" <eq name="data.type" value="T0">selected="selected"</eq>>T0</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-sm-2">
                                    <div class="form-group">
                                        <label class="control-label">支付通道</label>
                                        <select data-placeholder="请选择..."  tabindex="2" class="form-control" name="alleys">
                                            <option value="" >--请选择--</option>
                                            <foreach name="alleys" item="_v">
                                                <option value="{$_v}" <eq name="data.alleys" value="$_v">selected="selected"</eq>>{$_v|alleys_name}</option>
                                            </foreach>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="text-right">
                                <button class="btn btn-success" type="submit">搜索</button>
                                <button class="btn btn-default" value="ccl" name="export" type="submit"> <i class="fa fa-download"></i>导出</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <!--筛选功能结束-->



            <div class="panel-body">
                <div class="row text-center">
                    <div class="col-sm-2">
                        <div class="panel media middle">
                            <div class="media-left bg-info pad-all" style="padding: 10px;">
                                <i class="icon-3x iconfont" style="font-size: 3em;">&#xe636;</i>
                            </div>
                            <div class="media-body pad-all" style="padding: 10px;">
                                <p class="h3  text-thin mar-no">
                                    {$To.sum}</p>
                                <p class="text-muted mar-no">交易总额</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-2">
                        <div class="panel media middle">
                            <div class="media-left bg-info pad-all" style="padding: 10px;">
                                <i class="icon-3x iconfont" style="font-size: 3em;">&#xe68e;</i>
                            </div>
                            <div class="media-body pad-all" style="padding: 10px;">
                                <p class="h3  text-thin mar-no">{$To.count|default="0"}</p>
                                <p class="text-muted mar-no">交易笔数</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-2">
                        <div class="panel media middle">
                            <div class="media-left bg-info pad-all" style="padding: 10px;">
                                <i class="icon-3x iconfont" style="font-size: 3em;">&#xe611;</i>
                            </div>
                            <div class="media-body pad-all" style="padding: 10px;">
                                <p class="h3  text-thin mar-no">
                                    {$To.wxsum}</p>
                                <p class="text-muted mar-no">微信总额</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-2">
                        <div class="panel media middle">
                            <div class="media-left bg-info pad-all" style="padding: 10px;">
                                <i class="icon-3x iconfont" style="font-size: 3em;">&#xe66f;</i>
                            </div>
                            <div class="media-body pad-all" style="padding: 10px;">
                                <p class="h3  text-thin mar-no">{$To.wxcount|default="0"}</p>
                                <p class="text-muted mar-no">微信笔数</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-2">
                        <div class="panel media middle">
                            <div class="media-left bg-info pad-all" style="padding: 10px;">
                                <i class="icon-3x iconfont" style="font-size: 3em;">&#xe728;</i>
                            </div>
                            <div class="media-body pad-all" style="padding: 10px;">
                                <p class="h3  text-thin mar-no">
                                    {$To.alisum}</p>
                                <p class="text-muted mar-no">支付宝总额</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-2">
                        <div class="panel media middle" >
                            <div class="media-left bg-info pad-all" style="padding: 10px;">
                                <i class="icon-3x iconfont" style="font-size: 3em;">&#xe66f;</i>
                            </div>
                            <div class="media-body pad-all" style="padding: 10px;">
                                <p class="h3  text-thin mar-no">{$To.alicount|default="0"}</p>
                                <p class="text-muted mar-no">支付宝笔数</p>
                            </div>
                        </div>
                    </div>
                </div>

                <table  class="table  table-bordered table-hover toggle-circle text-center" data-page-size="7">
                    <thead>
                    <tr>
                        <th class="text-center">所属品牌</th>
                        <th class="text-center">所属代理</th>
                        <th class="text-center">所属商户</th>
                        <th class="text-center">门店名称</th>
                        <th class="text-center">交易类型</th>
                        <th class="text-center">交易时间</th>
                        <th class="text-center">完成时间</th>
                        <th class="text-center">交易金额</th>
                        <th class="text-center">交易单号</th>
                        <th class="text-center">交易状态</th>
                        <th class="text-center">通道类型</th>
                        <th class="text-center">支付通道</th>
                        <!--<th class="text-center">操作</th>-->
                    </tr>
                    </thead>
                    <tbody>
                    <foreach name="list" item="v">
                        <tr>
                            <td class="text-center">{$v.domain_auth|DomainName}</td>
                            <td class="text-center"><php>$agent=Get_Agent($v['mid']); echo $agent['user_name'];</php></td>
                            <td class="text-center" style="width: 120px"><php>$seller=Get_Seller($v['mid']); echo $seller['mch_name'];</php></td>
                            <td class="text-center" style="width: 120px"><php>$store=Get_Store($v['store_id']); echo $store['name'];</php></td>
                            <td class="text-center"><span class="label label-success" style="background-color:<php>echo pay_type_color($v['service']);</php>;font-size:12px;font-weight:1;border-radius: 5px;">{$v['service']|pays_type}</span></td>
                            <td>{$v['createtime']|date='Y-m-d H:i:s',###}</td>
                            <td>{$v['time_end']|date='Y-m-d H:i:s',###}</td>
                            <td><span class="label label-danger" style="font-size:12px;font-weight:1;border-radius: 5px;">{$v['total_fee']}</span></td>
                            <td>{$v['out_trade_no']}</td>
                            <td>{$v['status']|pays_status}</td>
                            <td>{$v['type']}</td>
                            <td class="text-center"><span class="label label-dark" style="background-color:<php>echo alleys_color($v['alleys']);</php>;font-size:12px;font-weight:1;border-radius: 5px;cursor: pointer;">{$v.alleys|alleys_name}</span></td>
                        </tr>
                    </foreach>
                    </tbody>
                    <tfoot>
                    <tr>
                        <td colspan="12">
                            <div class="text-right">
                                <ul class="pagination">{$page}</ul>
                            </div>
                        </td>
                    </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>
</div>
<link href="__PUBLIC__/iconfont/manage/iconfont.css" rel="stylesheet">
<script>
    $(function(){
        $("#demo-foo-addrow").resizableColumns({
            store: window.store
        });

    });

    $('.dialog').click(function () {
        var type= $('#domain_auths option:selected').val();
        if(!type){
            $.niftyNoty({
                type: 'danger',
                message : '<strong>请选择品牌后再使用代理筛选功能</strong>',
                container : 'floating',
                timer : 5000
            });
        }else {
            layer.open({
                type: 2,
                title: '检索',
                area: ['700px', '530px'],
                fixed: false, //不固定
                maxmin: false,
                content: "{:U('Agent/dialog')}/domain_auth/" + type
            });
        }
    });

    $('.mid_dialog').click(function () {
        var type= $('#domain_auths option:selected').val();
        if(!type){
            $.niftyNoty({
                type: 'danger',
                message : '<strong>请选择品牌后再使用商户筛选功能</strong>',
                container : 'floating',
                timer : 5000
            });
        }else {
            layer.open({
                type: 2,
                title: '商户检索',
                area: ['700px', '530px'],
                fixed: false, //不固定
                maxmin: false,
                content: "{:U('Merchant/mch_dialog')}/domain_auth/" + type
            });
        }
    });
    $('.store_dialog').click(function () {
        var type= $('#domain_auths option:selected').val();
        if(!type){
            $.niftyNoty({
                type: 'danger',
                message : '<strong>请选择品牌后再使用门店筛选功能</strong>',
                container : 'floating',
                timer : 5000
            });
        }else {
            layer.open({
                type: 2,
                title: '门店检索',
                area: ['700px', '530px'],
                fixed: false, //不固定
                maxmin: false,
                content: "{:U('Merchant/store_dialog')}/domain_auth/" + type
            });
        }
    });

    function SetTime(num){
        switch(num){
            case 1:
                s_time=GetDateStr(-1);
                e_time=GetDateStr(0);
                break;
            case 2:
                s_time=GetDateStr(0);
                e_time=GetDateStr(1);
                break;
            case 3:
                s_time=GetDateStr(-6);
                e_time=GetDateStr(1);
                break;
            case 4:
                s_time=GetDateStr(-30);
                e_time=GetDateStr(1);
                break;
        }
        $('[name="s_time"]').val(s_time);
        $('[name="e_time"]').val(e_time);
    }

    function GetDateStr(Day) {
        var dd = new Date();
        dd.setDate(dd.getDate()+Day);
        var y = dd.getFullYear();
        var m = dd.getMonth()+1;
        var d = dd.getDate();
        return y+"-"+m+"-"+d;
    }


</script>
<include file="Public/footer"/>