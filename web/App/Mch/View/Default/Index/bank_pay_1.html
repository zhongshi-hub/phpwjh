<!DOCTYPE html>
<html style="height: auto">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <title>在线支付</title>
</head>
<body></body>
<link rel="stylesheet" href="__YUI__/css/ydui.css"/>
<link rel="stylesheet" href="__YUI__/css/my-app.css"/>
<script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="__YUI__/js/ydui.js"></script>
<script src="__YUI__/js/ydui.flexible.js"></script>
<script>
    $(function () {
        var $this = $(this);
        var sid = '{$pay_data.aid}';
        var alleys = '{$pay_data.alleys}';
        var bank_id = '{$data.id}';
        var total = '{$pay_data.total_fee}';
        var id = '{$pay_data.mid}';
        var ajax_data = {type: 'banks', sid: sid, alleys: alleys, bank_id: bank_id, id: id, total: total};
        var actionurl = '{:U("Pays/CApi/gateway")}';

        YDUI.dialog.loading.open('通讯中...请稍等...');
        $.post(actionurl, ajax_data, function (data) {
            YDUI.dialog.loading.close();
            if (data.status == 1) {
                Xun_submitForm(data.info.action,data.info.v_data);
            } else {
                msg(data.info);
            }
        }, 'json');


        function msg(data) {
            YDUI.dialog.alert(data, 'none');
        }
        //创建form
        function Xun_submitForm(action, params) {
            var data = params;
            //alert(data.length);
            var form = $("<form></form>");
            form.attr('action', action);
            form.attr('method', 'post');
            //form.attr('target', '_self');
            for(var i=0 ; i < data.length;i ++){
                var input1 = $("<input type='hidden' name='"+data[i].name+"' />");
                input1.attr('value', data[i].val);
                form.append(input1);
            }
            form.appendTo("body");
            form.css('display', 'none');
            form.submit();
        }
    });

</script>