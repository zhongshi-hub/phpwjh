<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>我的分润</title>
    <meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" name="viewport"/>
    <meta content="yes" name="apple-mobile-web-app-capable"/>
    <meta content="black" name="apple-mobile-web-app-status-bar-style"/>
    <meta content="telephone=no" name="format-detection"/>
    <link rel="stylesheet" href="__PUBLIC__/mui/css/mui.min.css">
    <link rel="stylesheet" href="__YUI__/css/ydui.css"/>
    <link rel="stylesheet" href="__PUBLIC__/statics/plugins/font-awesome/css/font-awesome.min.css"/>
    <script src="__YUI__/js/ydui.flexible.js"></script>
    <link rel="stylesheet" href="__PUBLIC__/iconfont/iconfont.css"/>
    <link rel="stylesheet" href="__YUI__/css/my-app.css"/>
    <link rel="stylesheet" href="__PUBLIC__/layui/css/xun_push.css" media="all">
    <script src="__PUBLIC__/layui/layui.js" charset="utf-8"></script>
    <style>
        .m-cell{background-color: transparent!important;}
        .cell-item{background-color: #ffffff!important;}
        .mui-table-view{margin-top: 20px;font-size: 17px}
        .user {
            background: #fff none repeat scroll 0 0;
            height: 158px;
            position: relative;
            width: 100%;
        }
        .btn-primary{
            background-color:#4282e3;
        }
        .btn-primary:active{
            background-color:#5593F1;
        }
        .m-cell:after{
            border-bottom: 0px!important;
        }
        ::-webkit-input-placeholder {
            font-size:15px;
        }
        .toast-content{color: #ffffff}
        .m-confirm{width: 70%!important;border-radius: 5px!important;}
        .mask-black, .mask-black-dialog{
            background-color: rgba(0, 0, 0, 0.49)!important;
        }
        .confirm-ft>a.confirm-btn.primary{
            color: #4282e3!important;
        }
    </style>
</head>
<body>
<section class="g-flexview" style="margin-bottom: 50px">
    <div class="g-scrollview" style="margin-top: 0px">
        <div class="user" style="background: #4282e3">
            <div style="font-size: 14px;color: #ffffff;padding: 10% 10px;text-align: center">
                <div>总分润(元)</div>
                <br>
                <div style="font-size: 45px;" id="total_ye">{$benefit}</div>
                <input type="hidden" name="total_ye" value="{$benefit}">
            </div>
        </div>
        <!--<div class="m-button">-->
            <!--<button id="tx_button" type="button" class="btn-block btn-primary" style="letter-spacing:3px;" disabled>提现</button>-->
        <!--</div>-->
        <div class="m-cell benefitData" style="margin-top: 5px">
        </div>
</section>
<footer class="m-tabbar tabbar-fixed">
    <a href="{:U('Index/index')}" class="tabbar-item ">
                <span class="tabbar-icon">
                    <i class="icon-home-outline"></i>
                </span>
        <span class="tabbar-txt">主页</span>
    </a>
    <a href="{:U('Index/order')}" class="tabbar-item ">
                <span class="tabbar-icon">
                    <i class="icon-order"></i>
                    <span class="tabbar-dot"></span>
                </span>
        <span class="tabbar-txt">流水</span>
    </a>
    <a href="{:U('Index/my')}" class="tabbar-item tabbar-active">
                <span class="tabbar-icon">
                    <i class="icon-ucenter-outline"></i>
                </span>
        <span class="tabbar-txt">我的</span>
    </a>
</footer>
<script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="__YUI__/js/ydui.js"></script>
<script>
    layui.use('flow', function () {
        var flow = layui.flow;
        flow.load({
            elem: '.benefitData' //流加载容器
            , mb: '230' //滚动条所在元素，一般不用填，此处只是演示需要。
            , done: function (page, next) { //执行下一页的回调
                var ajax_data = {pages: page};
                var actionurl = '{:U("benefitDataJson")}';
                $.get(actionurl, ajax_data, function (res) {
                    var lis = [];
                    layui.each(res.data, function (index, rel) {
                        lis.push('<div class="cell-item">'+
                            '<div class="cell-left">'+rel.day+'</div>'+
                            '<div class="cell-right">'+rel.benefit+'元</div>'+
                            '</div>');
                    });
                    next(lis.join(''), page < res.pages);
                }, 'json');

            }
        });
    });



    $(function() {
        // YDUI.dialog.loading.open('获取可提现金额中...');
        // var total=$('[name="tx_total"]'),total_ye=$('[name="total_ye"]');
        // $.ajax({
        //     url: "/Pays/CRhcard/Balance?Debug=1",
        //     dataType: 'json',
        //     data: {cid: {$_SESSION['mch']['id']},alleys:'Rhcard'},
        //     type: 'post',
        //     success: function (res) {
        //         YDUI.dialog.loading.close();
        //         if (res.status == 1) {
        //             $('#total_ye').html(res.info.canbalance);
        //             total_ye.val(res.info.canbalance);
        //             if(res.info.canbalance<=100){
        //                 $('#tx_button').attr("disabled",true);
        //             }else{
        //                 $('#tx_button').attr("disabled",false);
        //             }
        //         } else {
        //             show(res.info);
        //         }
        //     },
        //     error: function (res) {
        //         YDUI.dialog.loading.close();
        //         show('通信失败');
        //     }
        // });


        $('#all').on('click',function () {
            total.val(total_ye.val());
            if(total_ye.val()>=100){
                $('#tx_button').attr("disabled",false);
            }else{
                $('#tx_button').attr("disabled",true);
            }
        });
        //提现
        $('#tx_button').on('click',function () {
            if(parseFloat(total_ye.val())<=100){
                show('还款金额最低100元');
            }else{
                order_tx();
            }
        })
    });
    function order_tx() {
        YDUI.dialog.loading.open('提现请求中,请稍等...');
        var total=$('[name="tx_total"]');
        $.ajax({
            url: "/Pays/Apis/gateway_type",
            dataType: 'json',
            data: {cid: {$_SESSION['mch']['id']},alleys:'Sftpays',way_type:'mch_withdraw',tx_total:total.val()},
            type: 'post',
            success: function (res) {
                YDUI.dialog.loading.close();
                if (res.status == 1) {
                    /*YDUI.dialog.toast(res.info, 'none', 2000,function () {
                        window.location.href=res.url;
                    });*/
                    YDUI.dialog.alert(res.info, function(){
                        window.location.href=res.url;
                    });
                } else {
                    show(res.info);
                }
            },
            error: function (res) {
                YDUI.dialog.loading.close();
                show('通信失败');
            }
        });
    }
    function show(data) {
        YDUI.dialog.toast(data, 'none', 2000);
    }
</script>
</body>
</html>
