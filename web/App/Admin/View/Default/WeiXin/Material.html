<include file="WeiXin/header"/>

<div id="content-container">
    <div id="page-content">
        <div class="panel">
            <div class="panel-heading">
                <div class="panel-control">
                    <span class="text-muted">

                    </span>
                    <span class="text-muted"><small></small></span>
                </div>
                <h3 class="panel-title">{:$title}</h3>
            </div>
            <link href="/Source/Css/wechat/common.css" rel="stylesheet">
            <div class="panel-body">
                <ul class="xun-page-tab" style="margin-left: 3px;margin-right: 3px">
                    <li class="active">
                        <a href="{:U('WeiXin/Material',array('token'=>$_SESSION['Admin']['WxToken']))}">微信图文</a>
                    </li>
                    <li>
                        <a href="{:U('WeiXin/MaterialImage',array('token'=>$_SESSION['Admin']['WxToken']))}">图片</a>
                    </li>
                </ul>
                    <div id="main" ng-controller="materialDisplay" class="ng-scope">
                        <div class="material">
                            <div class="material-appmsg">
                                <div class="material-list-head clearfix">
                                    <div class="info col-sm-6 xun-padding-none">
                                        <div class="xun-form">
                                            <div class="form-controls">
                                                <form action="" method="post" class="ng-pristine ng-valid">
                                                    <div class="input-group">
                                                        <input id="" name="title" class="form-control" size="40" value="" placeholder="标题/作者/摘要" type="text">
                                                        <span class="input-group-btn">
										<button class="btn btn-default"><i class="fa fa-search"></i></button>
									</span>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="pull-right">
                                        <a href="javascript:;"  onclick="sync('news')" class="btn btn-default">同步微信</a>
                                        <a href="javascript:;"  onclick="news_message();"  class="btn btn-primary xun-margin-left">新建图文消息</a>
                                    </div>
                                </div>

                                <!--multi-->
                                <div class="material-appmsg-list " style="margin-left: 0px;margin-right: 0px;">

                                    <foreach name="data" item="v">
                                    <div class="material-appmsg-item <neq name='v.count' value='1'>multi</neq> ">
                                        <div class="appmsg-content">
                                            <div class="appmsg-info">
                                                <em class="appmsg-date" style="color: #666">更新于  {$v.update_time}</em>
                                            </div>
                                                <eq name="v.count" value="1">
                                                    <foreach name="v.item" item="val" key="k">
                                                    <div class="appmsg-item">
                                                        <h4 class="appmsg-title">
                                                            <a href="" target="_blank">{$val.title} </a>
                                                        </h4>
                                                        <div class="appmsg-thumb" style="background-image:url('{$val.img}')">
                                                        </div>
                                                        <p class="appmsg-desc" style="color: #666;text-align: left;padding-bottom: 1px;margin-bottom:1px;margin-top:10px;white-space: inherit">{$val.digest}</p>
                                                        <a href="{$val.url}" target="_blank" class="cover-dark">
                                                            <div class="edit-mask-content">
                                                                微信预览
                                                            </div>
                                                            <span class="vm-box"></span>
                                                        </a>
                                                     </div>
                                                     </foreach>
                                                <else/>
                                                    <foreach name="v.item" item="val" key="k">
                                                    <div class=" <neq name='k' value='0'> appmsg-item has-cover<else/>cover-appmsg-item</neq> ">
                                                        <neq name='k' value='0'>
                                                            <div class="appmsg-thumb" style="background-image:url('{$val.img}">
                                                            </div>
                                                            <h4 class="appmsg-title">
                                                                <a href="" target="_blank" style="white-space: normal">{$val.title}</a>
                                                            </h4>
                                                            <a href="{$val.url}" target="_blank" class="cover-dark">
                                                                <div class="edit-mask-content">
                                                                    <p class="">
                                                                        预览文章 </p>
                                                                </div>
                                                                <span class="vm-box"></span>
                                                            </a>
                                                        <else/>
                                                            <h4 class="appmsg-title">
                                                                <a href="" target="_blank" style="white-space: inherit;margin-left: 10px;margin-right: 5px">{$val.title}</a>
                                                            </h4>
                                                            <div class="appmsg-thumb" style="background-image:url('{$val.img}')">
                                                            </div>
                                                            <p class="appmsg-desc">{$val.digest}</p>
                                                            <a href="{$val.url}" target="_blank" class="cover-dark">
                                                                <div class="edit-mask-content">
                                                                    微信预览
                                                                </div>
                                                                <span class="vm-box"></span>
                                                            </a>
                                                        </neq>
                                                    </div>
                                                    </foreach>
                                                </eq>


                                        </div>
                                        <!--<div class="appmsg-opr">
                                            <ul>
                                                <li class="appmsg-opr-item">
                                                    <a href="" class="add-tooltip" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="编辑">&nbsp;<i class="fa fa-edit" style="font-size: 20px;color: #98999a;vertical-align: middle;"></i></a>
                                                </li>
                                                <li class="appmsg-opr-item">
                                                    <a class="add-tooltip" href="javascript:void(0);" ng-click="del_material('news', '7', 'wechat')" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="删除">&nbsp;<i class="fa fa-trash-o" style="font-size: 20px;color: #98999a;vertical-align: middle;"></i></a>
                                                </li>
                                            </ul>
                                        </div>-->
                                    </div>
                                   </foreach>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="text-right">
                        <ul class="pagination">{$page}</ul>
                    </div>

                   <link rel="stylesheet" href="__PUBLIC__/loading/css/loading.css">
                   <script src="__PUBLIC__/loading/js/loading.js"></script>
                   <script src="/Source/Css/wechat/jquery.wookmark.min.js"></script>
                   <script>
                        $('.material-appmsg-list .material-appmsg-item').wookmark({
                            align: 'left',
                            autoResize: true,
                            container: $('.material-appmsg-list'),
                            itemWidth: 289,
                            offset: 30
                        });
                       function sync(type) {
                           load_show('show','news','图文信息同步中。请等待。。。');
                           var ajax_data = {type:type};
                           var actionurl = '{:U("GetMaterial")}';
                           $.post(actionurl, ajax_data, function(data){
                               load_show('hide','news');
                               if(data.status == 1){
                                   $.niftyNoty({
                                       type: 'success',
                                       message : '<strong>'+data.info+'</strong>',
                                       container : 'floating',
                                       timer : 3000
                                   });
                                   setTimeout(function(){
                                       window.location.href=data.url
                                   }, 3000);
                               }
                               else{
                                   $.niftyNoty({
                                       type: 'danger',
                                       message : '<strong>'+data.info+'</strong>',
                                       container : 'floating',
                                       timer : 5000
                                   });
                                   if(data.url){
                                       setTimeout(function(){
                                           window.location.href=data.url
                                       }, 3000);
                                   }
                               }
                           }, 'json');
                       }

                       /*show hide*/
                       function load_show(type,name,txt) {
                           if(type=='show') {
                               $('body').loading({
                                   loadingWidth: 240,
                                   title: '',
                                   name: name,
                                   discription: txt,
                                   discColor:'#fff',
                                   direction: 'column',
                                   type: 'origin',
                                   originDivWidth: 40,
                                   originDivHeight: 40,
                                   originWidth: 6,
                                   originHeight: 6,
                                   smallLoading: false,
                                   loadingMaskBg: 'rgba(0,0,0,0.2)'
                               });
                           }else{
                              removeLoading(name);
                           }
                       }
                       
                       function news_message() {
                           $.niftyNoty({
                               type: 'danger',
                               message : '<strong>温馨提示:系统不支持新建图文<br>请在微信公众号平台(mp.weixin.qq.com)中新建,然后在此页面同步微信数据</strong>',
                               container : 'floating',
                               timer : 5000
                           });
                       }
                   </script>
                </div>
            </div>
        </div>
    </div>
</div>
