<extend name="Common:base" />
<block name="top_css">
    <link href="__PUBLIC__/amp/plugins/ion-rangeslider/ion.rangeSlider.css" rel="stylesheet" type="text/css"/>
    <link href="__PUBLIC__/amp/plugins/ion-rangeslider/ion.rangeSlider.skinModern.css" rel="stylesheet" type="text/css"/>
    <link href="__PUBLIC__/amp/plugins/select2/css/select2.min.css" rel="stylesheet" type="text/css" />
    <link href="__PUBLIC__/amp/plugins/sweet-alert/sweetalert2.min.css" rel="stylesheet" type="text/css" />
</block>
<block name="title">云喇叭配置</block>
<block name="menu_name">云喇叭配置</block>
<block name="body">
    <div class="row">
        <div class="col-md-12">
            <div class="card-box">
                <h4 class="m-t-0 header-title">云喇叭<code class="highlighter-rouge">{$ylbState}</code></h4>
                <p class="text-muted m-b-30 font-13">
                   云喇叭用来播报<code class="highlighter-rouge">支付成功</code>后的订单信息 如微信收款1元
                </p>
                <form method="post" action="{:U('speakerSave')}">
                    <div class="form-group">
                        <label for="id" class="col-form-label">设备ID</label>
                        <input  class="form-control" id="id" type="text" name="vid" value="{$data.vid}"  required>
                    </div>
                    <div class="form-group">
                        <label for="num" class="col-form-label">设备音量</label>
                        <div class="col-sm-12 col-xs-12">
                            <input type="text" id="num" name="num" value="{$data.num|default='100'}">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-form-label">状态</label>
                        <select   data-placeholder="请选择..."  tabindex="2"  class="form-control select2" name="status" required="required">
                            <option value="1" <eq name="data.status" value="1">selected</eq> >开启播报</option>
                            <option value="0" <eq name="data.status" value="0">selected</eq> >关闭播报</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="5" class="col-form-label">AppId</label>
                            <input type="text" class="form-control" id="5" name="appid" value="{$data.appid}" placeholder="">
                        </div>
                        <div class="form-group col-md-6">
                            <label for="6" class="col-form-label">AppKey</label>
                            <input type="text" class="form-control" id="6" name="appkey" value="{$data.appkey}" placeholder="">
                        </div>
                    </div>
                    <p class="text-muted m-b-30 font-13">
                        如自购云喇叭需填写AppId和AppKey  <code class="highlighter-rouge">使用平台发配的无需填写AppId和AppKey</code>
                    </p>

                    <input type="hidden" name="sid" value="{$_GET['id']}">
                    <button type="submit" class="btn btn-success">保 存</button>
                    <button type="button" class="btn btn-success" id="testSp">测试播报</button>
                </form>
            </div>
        </div>
    </div>
</block>
<block name="footer_js">
    <script src="__PUBLIC__/amp/plugins/select2/js/select2.min.js" type="text/javascript"></script>
    <script src="__PUBLIC__/amp/plugins/ion-rangeslider/ion.rangeSlider.min.js"></script>
    <script src="__PUBLIC__/amp/plugins/sweet-alert/sweetalert2.min.js"></script>
    <script>
        jQuery(document).ready(function () {
            $(".select2").select2();
            $("#num").ionRangeSlider({
                grid: true,
                min: 0,
                max: 100,
                from: "{$data.num|default='100'}",
                step: 1,
                prettify_enabled: true
            });
            $('#testSp').click(function () {
                swal({
                    title: '请输入测试金额,默认为微信收款方式',
                    input: 'text',
                    showCancelButton: true,
                    confirmButtonText: '提交',
                    cancelButtonText:'取消',
                    showLoaderOnConfirm: true,
                    confirmButtonClass: 'btn btn-confirm mt-2',
                    cancelButtonClass: 'btn btn-cancel ml-2 mt-2',
                    inputValue:'0.01',
                    preConfirm: function (text) {
                        return new Promise(function (resolve, reject) {
                            setTimeout(function () {
                                if (isNaN(text)) {
                                    reject('请输入正确的数字.')
                                } else {
                                    resolve()
                                }
                            }, 2000);
                        })
                    },
                    allowOutsideClick: false
                }).then(function (text) {
                    $.post('{:U("testSpeaker")}',{id:{$Think.get.id},total:text}, function (data) {
                        if (data.status === 1) {
                            swal({
                                type: 'success',
                                title: '处理成功',
                                html: data.info,
                                confirmButtonClass: 'btn btn-confirm mt-2'
                            })
                        }
                        else {
                            swal({
                                type: 'warning',
                                title: '测试信息发送失败',
                                html: data.info,
                                confirmButtonClass: 'btn btn-confirm mt-2'
                            })
                        }
                    }, 'json');
                })
            });
        });
    </script>
</block>